---
import Layout from "../../layouts/layout.astro";
import products from "../../data/products.json";
import "../../styles/product.css";

export async function getStaticPaths() {
    return products.map(p => ({
        params: { id: p.id.toString() },
    }));
}

const { id } = Astro.params;
const numericCount = Number(id);

const product = products.find(p => p.id === numericCount);

if (!product) {
    throw new Error("Product not found");
}
---

<Layout title="Детальна інформація">
    <h1>{ product.name }</h1>
    <div id="carouselExampleControlsNoTouching" class="carousel slide" data-bs-touch="false">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src={product.image} class="d-block w-100" alt="Photo1">
            </div>
            <div class="carousel-item">
                <img src={product.image2} class="d-block w-100" alt="Photo2">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <br>
    <p>{ product.description }</p>
    <p>Ціна: { product.price } ₴</p>
    <h3>Оформити замовлення</h3>

    <div id="output"></div>

    <form id="send-form">
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Електронна пошта</label>
            <input type="email" class="form-control w-50" id="exampleInputEmail1" aria-describedby="emailHelp">
        </div>
        <div class="mb-3">
            <label for="exampleInputPassword1" class="form-label">Пароль</label>
            <input type="password" class="form-control w-50" id="exampleInputPassword1">
        </div>
        <div class="mb-3">
            <label for="exampleInputPassword1" class="form-label">Підтвердіть пароль</label>
            <input type="password" class="form-control w-50" id="exampleInputPasswordConfirm1">
        </div>
        <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Примітка</label>
            <textarea class="form-control w-50" id="exampleFormControlTextarea1" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Підтвердити</button>
    </form>
    <br><br>
    <script is:inline>
        const sendForm = document.querySelector('#send-form');
        const output = document.querySelector('#output');
        sendForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.querySelector('#exampleInputEmail1').value;
            const password = document.querySelector('#exampleInputPassword1').value;
            const passwordCheck = document.querySelector('#exampleInputPasswordConfirm1').value;
            const alertDiv = document.createElement('div');
            if (password === passwordCheck) {
                alertDiv.classList.add('alert', 'alert-success');
                alertDiv.setAttribute('role', 'alert');
                alertDiv.innerHTML = `
                    <h4 class="alert-heading">Готово!</h4>
                    <p>Ваше замовлення оформлено успішно. Очікуйте електронного листа з підтвердженням на ${email}.</p>
                `;
            } else {
                alertDiv.classList.add('alert', 'alert-danger');
                alertDiv.setAttribute('role', 'alert');
                alertDiv.innerHTML = `
                    <h4 class="alert-heading">Помилка!</h4>
                    <p>Паролі не збігаються.</p>
                `;
            }
            output.innerHTML = '';
            output.appendChild(alertDiv);
        });
    </script>
</Layout>
